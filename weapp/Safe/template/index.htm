{include file="header.htm" /}
<body class="bodystyle" style="overflow-y: scroll; cursor: default; -moz-user-select: inherit;">
<div id="toolTipLayer" style="position: absolute; z-index: 9999; display: none; visibility: visible; left: 95px; top: 573px;"></div>
<div id="append_parent"></div>
<div id="ajaxwaitid"></div>
<div class="page">
    {include file="bar.htm" /}
    <form class="form-horizontal" id="post_form" action="{:weapp_url('Safe/Safe/index')}" method="post">
        <div class="ncap-form-default">
            <dl class="row">
                <dt class="tit">
                    <label>所属IP段</label>
                </dt>
                <dd class="opt">
                    {$ipSegment}（ 当前IP地址：{$currentIp} ）
                    <span class="err"></span>
                    <p class="notic"></p>
                </dd>
            </dl>
            <dl class="row">
                <dt class="tit">
                    <label for="ip_whitelist">IP段白名单</label>
                </dt>
                <dd class="opt">
                    <textarea rows="5" cols="80" id="ip_whitelist" name="ip_whitelist" style="height:80px;" placeholder="为空默认不限制，IP段示例如下：
127.0.0.1
192.168.1.2
192.168.0.1-192.168.0.255">{$row.ip_whitelist|default=''}</textarea>
                    <p class="">多个设置用回车换行，一行代表一个IP白名单解除限制。<br/>示例（如果是单个IP单独写；如果是IP段用“-”连接最小和最大IP（192.168.0.1-192.168.255.255）</p>
                </dd>
            </dl>
            <dl class="row">
                <dt class="tit">
                    <label>禁止功能</label>
                </dt>
                <dd class="opt">
                    <label><input type="checkbox" name="prohibit_adminlogin" value="1" {if condition="!empty($row.prohibit_adminlogin)"} checked="checked" {/if}>后台登录</label>&nbsp;&nbsp;
                    <label><input type="checkbox" name="prohibit_save" value="1" {if condition="!empty($row.prohibit_save)"} checked="checked" {/if}>保存/删除</label>&nbsp;&nbsp;
                    <label><input type="checkbox" name="prohibit_upload" value="1" {if condition="!empty($row.prohibit_upload)"} checked="checked" {/if}>上传</label>&nbsp;&nbsp;
                    <!-- <label><input type="checkbox" name="prohibit_upgrade" value="1" {if condition="!empty($row.prohibit_upgrade)"} checked="checked" {/if}>升级</label>&nbsp;&nbsp; -->
                    <span class="err"></span>
                    <p class="notic">访问IP不在IP段白名单时，禁止勾选中的功能</p>
                </dd>
            </dl>
            <div class="bot">
                <a href="JavaScript:void(0);" onclick="checkForm();" class="ncap-btn-big ncap-btn-green" id="submitBtn">确认提交</a>
            </div>
        </div>
    </form>
</div>
<script type="text/javascript">
    // 判断输入框是否为空
    function checkForm(){
        layer_loading('正在处理');
        $.ajax({
            type : 'post',
            url : "{:weapp_url('Safe/Safe/index', ['_ajax'=>1])}",
            data : $('#post_form').serialize(),
            dataType : 'json',
            success : function(res){
                layer.closeAll();
                if(res.code == 1){
                    layer.msg(res.msg, {time: 1000}, function(){
                        window.location.reload();
                    });
                }else{
                    showErrorAlert(res.msg);
                }
            },
            error: function(e){
                layer.closeAll();
                showErrorAlert(e.responseText);
            }
        });
    }
</script>
{include file="footer.htm" /}